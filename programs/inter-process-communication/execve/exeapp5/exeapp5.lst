     1                                  ; Name:         exeapp3.asm
     2                                  ; Build:        see makefile
     3                                  ; Run:          ./exeapp3
     4                                  ; Description:  Demonstration on how to execute a bash script from a program.
     5                                  ;               The program starts the sh command and executes a script named test.
     6                                  ;
     7                                  ; More info:    http://geoffgarside.co.uk/2009/08/28/using-execve-for-the-first-time/
     8                                  ;
     9                                  ; Remark:       Before running this tiny program, you have to run (only once) the following command in your terminal:
    10                                  ;               echo "echo 'hello world'" > test
    11                                  ;               or you make your own test script which the program then executes.
    12                                  
    13                                  BITS 64
    14                                  
   613                                  [list -]
   614                                  
   615                                  section .bss
   616                                  
   617                                  section .data
   618                                          
   619 00000000 2F7573722F62696E2F-     filename    db      "/usr/bin/nasm",0             ; full path!
   620 00000009 6E61736D00         
   621                                  
   622                                  ;argv1       db      "2", 0;                                      ; "test.sh", 0            ; script to execute
   623                                  ;argv2       db      "mmap", 0
   624                                  
   625                                  ;... put more arguments here
   626                                  
   627 0000000E 444953504C41593D3A-     envp1       db      "DISPLAY=:0",0
   628 00000017 3000               
   629 00000019 5348454C4C3D2F6269-     envp2       db      "SHELL=/bin/bash",0
   630 00000022 6E2F6261736800     
   631 00000029 5445524D3D78746572-     envp3:      db      "TERM=xterm",0
   632 00000032 6D00               
   633                                      
   634 00000034 [0000000000000000]      argvPtr :   dq      filename
   635                                              ;dq      argv1
   636                                              ;dq      argv2
   637                                              ;dq      0
   638                                              ; more pointers to arguments here
   639 0000003C 0000000000000000                    dq      0                               ; terminate the list of pointers with NULL
   640                                  
   641                                  envPtr:      ;dq      envp1
   642                                              ;dq      envp2
   643                                              ;dq      envp3
   644 00000044 0000000000000000                    dq      0
   645                                          
   646                                  section .text
   647                                  
   648                                  global _start
   649                                  _start:
   650                                  
   651 00000000 48BA-                         mov       rdx, envPtr             ; no environment pointers
   652 00000002 [4400000000000000] 
   653 0000000A 48BE-                         mov       rsi, argvPtr            ; pointer to array with arguments
   654 0000000C [3400000000000000] 
   655 00000014 48BF-                         mov       rdi, filename           ; ponter to the command to execute
   656 00000016 [0000000000000000] 
   657 0000001E B83B000000                    mov       rax, SYS_EXECVE         ; syscall execute
   658 00000023 0F05                          syscall
   659 00000025 4831FF                        xor       rdi, rdi
   660 00000028 B83C000000                    mov       rax, SYS_EXIT
   661 0000002D 0F05                          syscall
